<div class="cbi-value<% if self.error and self.error[section] then %> cbi-value-error<% end %><% if self.last_child then %> cbi-value-last<% end %>" id="cbi-<%=self.config.."-"..section.."-"..self.option%>">
    <%- if self.title and #self.title > 0 then -%>
    <label class="cbi-value-title"<%= attr("for", cbid) %>>
	<%- if self.titleref then -%><a title="<%=self.titledesc or translate('Go to relevant configuration page')%>" class="cbi-title-ref" href="<%=self.titleref%>"><%- end -%>
	    <%-=self.title-%>
	    <%- if self.titleref then -%></a><%- end -%>
    </label>
    <div class="cbi-value-field">
	<%- end -%>
	<input type="<%=self.password and 'password" class="cbi-input-password' or 'text" class="cbi-input-text' %>" onchange="cbi_d_update(this.id)"<%=
	attr("name", cbid) .. attr("id", cbid) .. attr("value", self:cfgvalue(section) or self.default) ..
	ifattr(self.size, "size") .. ifattr(self.placeholder, "placeholder")
	%> />

	<% if self.description and #self.description > 0 then -%>
	<% if not luci.util.instanceof(self, luci.cbi.DynamicList) and (not luci.util.instanceof(self, luci.cbi.Flag) or self.orientation == "horizontal") then -%>
	<br />
	<%- end %>
	<div class="cbi-value-description">
	    <span class="cbi-value-helpicon"><img src="<%=resource%>/cbi/help.gif" alt="<%:help%>" /></span>
	    <%=self.description%>
	</div>
	<%- end %>
	<%- if self.title and #self.title > 0 then -%>
    </div>
    <%- end -%>
</div>


<% if #self.deps > 0 or #self.subdeps > 0 then -%>
<script type="text/javascript" id="cbip-<%=self.config.."-"..section.."-"..self.option%>">
    <% for j, d in ipairs(self.subdeps) do -%>
    cbi_d_add("cbi-<%=self.config.."-"..section.."-"..self.option..d.add%>", {
	    <%-
	    for k,v in pairs(d.deps) do
	    local depk
	    if k:find("!", 1, true) then
	    depk = string.format('"%s"', k)
	    elseif k:find(".", 1, true) then
	    depk = string.format('"cbid.%s"', k)
	    else
	    depk = string.format('"cbid.%s.%s.%s"', self.config, section, k)
	    end
	    -%>
	    <%-= depk .. ":" .. string.format("%q", v)-%>
	    <%-if next(d.deps, k) then-%>,<%-end-%>
	    <%-
	    end
	    -%>
	    }, "cbip-<%=self.config.."-"..section.."-"..self.option..d.add%>");
<%- end %>
<% for j, d in ipairs(self.deps) do -%>
cbi_d_add("cbi-<%=self.config.."-"..section.."-"..self.option..d.add%>", {
	<%-
	for k,v in pairs(d.deps) do
	local depk
	if k:find("!", 1, true) then
	depk = string.format('"%s"', k)
	elseif k:find(".", 1, true) then
	depk = string.format('"cbid.%s"', k)
	else
	depk = string.format('"cbid.%s.%s.%s"', self.config, section, k)
	end
	-%>
	<%-= depk .. ":" .. string.format("%q", v)-%>
	<%-if next(d.deps, k) then-%>,<%-end-%>
	<%-
	end
	-%>
	}, "cbip-<%=self.config.."-"..section.."-"..self.option..d.add%>");
<%- end %>
</script>
<%- end %>

